<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="sqltap profile">
    <meta name="author" content="inconshreveable">

    <title>SQLTap Profiling Report</title>

    <!-- Bootstrap core CSS -->
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet">

    <!-- syntax highlighting -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.8.0/styles/default.min.css" rel="stylesheet">
    <style type="text/css">
      body { padding-top: 60px; }
      #query-groups {
        border-right: 1px solid #ccc;
      }
      #total-time { color: #fff; }
      #total-time .sum { color: #0f0; font-size: 16px; }
      #total-time .count { color: #0f0; font-size: 16px; }
      a.toggle { cursor: pointer }
      a.toggle strong { color: red; }
    </style>
  </head>

  <body>

    <div class="container">
      <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
        <div class="container">
          <div class="navbar-header">
            <a class="navbar-brand" href="https://github.com/inconshreveable/sqltap">sqltap</a>
          </div>
          <ul class="navbar-right nav navbar-nav">
            <li><a target="_blank" href="http://sqltap.inconshreveable.com/">Documentation</a></li>
            <li><a target="_blank" href="https://github.com/inconshreveable/sqltap">Code</a></li>
          </ul>
          <p id="total-time" class="navbar-text">
            <span class="count">1</span> queries spent
            <span class="sum">0.02</span> seconds
            over <span class="sum">0.02</span> seconds of profiling
          </p>
          
        </div>
      </div>
      <h1>
      </h1>
      <div class="row">
        <div class="col-xs-3" id="query-groups" style="min-height: 600px">

          <ul class="nav nav-pills nav-stacked" id="myTabs">
            <li class="active">
              <a href="#query-0" data-toggle="tab">
                <span class="label label-default pull-right"
                      style="margin-right: 5px; width: 8ex; text-align: right;">
                    340r
                </span>
                <span class="label label-warning pull-right" style="margin-right: 5px;">
                    0.017s
                </span>
                <span class="label label-info pull-right" style="margin-right: 5px;">
                  1q
                </span>
SELECT
              </a>
            </li>
          </ul>

          <hr />

            <div>
            <span>Report Generated: 2025-02-05 16:39:16</span>
          </div>
        </div>

        <!-- ================================================== -->

        <div class="col-xs-9">

          <div class="tab-content">
            <div id="query-0" class="tab-pane active">
              <h4 class="toggle">
                  <ul class="list-inline">
                    <li>
                      <dt>Query Count</dt>
                      <dd>1</dd>
                    </li>
                    <li>
                      <dt>Row Count</dt>
                      <dd>340</dd>
                    </li>
                    <li>
                      <dt>Total Time</dt>
                      <dd>0.017</dd>
                    </li>
                    <li>
                      <dt>Mean</dt>
                      <dd>0.017</dd>
                    </li>
                    <li>
                      <dt>Median</dt>
                      <dd>0.017</dd>
                    </li>
                    <li>
                      <dt>Min</dt>
                      <dd>0.017</dd>
                    </li>
                    <li>
                      <dt>Max</dt>
                      <dd>0.017</dd>
                    </li>
                  </ul>
              </h4>

              <hr />
              <pre><code class="sql">SELECT assets.asset_seq,
       assets.created,
       assets.updated,
       assets.deleted,
       assets.org_seq,
       assets.owner_seq,
       asset_versions.asset_seq AS asset_seq_1,
       asset_versions.published,
       asset_versions.major,
       asset_versions.minor,
       asset_versions.patch,
       asset_versions.commit_ref,
       asset_versions.created AS created_1,
       asset_versions.name,
       asset_versions.description,
       asset_versions.blurb,
       asset_versions.author_seq,
       asset_versions.package_seq,
       asset_versions.contents,
       asset_versions.deleted AS deleted_1,
       files.file_seq,
       files.name AS name_1,
       files.created AS created_2,
       files.updated AS updated_1,
       files.deleted AS deleted_2,
       files.size,
       files.purpose,
       files.content_type,
       files.owner_seq AS owner_seq_1,
       files.cache_ttl,
       files.downloads,
       files.lifetime,
       files.content_hash,
       files.locators,
       anon_1.tag_to_asset,
       profiles_1.name AS name_2,
       profiles_2.name AS name_3,
       orgs.name AS name_4
FROM assets
LEFT OUTER JOIN asset_versions ON assets.asset_seq = asset_versions.asset_seq
LEFT OUTER JOIN files ON files.file_seq = asset_versions.package_seq
LEFT OUTER JOIN
  (SELECT asset_tags.type_seq AS asset_seq,
          json_agg(json_build_object(%(json_build_object_1)s, asset_tags.tag_seq, %(json_build_object_2)s, tags.name)) AS tag_to_asset
   FROM asset_tags
   JOIN tags ON tags.tag_seq = asset_tags.tag_seq
   GROUP BY asset_tags.type_seq) AS anon_1 ON anon_1.asset_seq = assets.asset_seq
LEFT OUTER JOIN profiles AS profiles_1 ON profiles_1.profile_seq = assets.owner_seq
LEFT OUTER JOIN profiles AS profiles_2 ON profiles_2.profile_seq = asset_versions.author_seq
LEFT OUTER JOIN orgs ON orgs.org_seq = assets.org_seq
WHERE asset_versions.published = true
  AND asset_versions.package_seq IS NOT NULL
  AND assets.deleted IS NULL
  AND asset_versions.deleted IS NULL</code></pre>
              <hr />

              
              <h4>
                Query Breakdown
              </h4>
              <table class="table">
                <tr>
                  <th>Query Time</th>
                  <th><code>json_build_object_1</code></th>
                  <th><code>json_build_object_2</code></th>
                  <th>Row Count</th>
                  <th>Params ID</th>
                </tr>
                <tr class="">
                    <td>0.017</td>
                    <td>tag_seq</td>
                    <td>tag_name</td>
                    <td>340</td>
                    <td>4</td>
                </tr>
              </table>

              <hr />
              
              <h4>
                  1 unique parameter
                      set is
                  supplied.
              </h4>
              <ul class="details">
                  <li class="">
                    <h5>
                      1
                      call
                      (Params ID: 4) with
                      <tt>
                        json_build_object_1=&#39;tag_seq&#39;, json_build_object_2=&#39;tag_name&#39;
                      </tt>
                    </h5>
                  </li>
              </ul>

              <hr />
              
              <h4>
                  1 unique
                      stack issues
                  this query
              </h4>
              <ul class="details">
                  <li>
                    <a class="toggle">
                      <h5>
                      
                      1
                      call from
                      <strong>exec</strong> @/home/work/work/infra/api/app/.venv/lib/python3.12/site-packages/sqlmodel/orm/session.py:66
                      </h5>
                    </a>
                    <pre class="trace hidden"><code class="python">File &#34;/usr/lib/python3.12/threading.py&#34;, line 1032, in _bootstrap
    self._bootstrap_inner()
  File &#34;/usr/lib/python3.12/threading.py&#34;, line 1075, in _bootstrap_inner
    self.run()
  File &#34;/usr/lib/python3.12/threading.py&#34;, line 1012, in run
    self._target(*self._args, **self._kwargs)
  File &#34;/home/work/work/infra/api/app/.venv/lib/python3.12/site-packages/anyio/from_thread.py&#34;, line 481, in run_blocking_portal
    _eventloop.run(
  File &#34;/home/work/work/infra/api/app/.venv/lib/python3.12/site-packages/anyio/_core/_eventloop.py&#34;, line 74, in run
    return async_backend.run(func, args, {}, backend_options)
  File &#34;/home/work/work/infra/api/app/.venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py&#34;, line 2303, in run
    return runner.run(wrapper())
  File &#34;/usr/lib/python3.12/asyncio/runners.py&#34;, line 118, in run
    return self._loop.run_until_complete(task)
  File &#34;/usr/lib/python3.12/asyncio/base_events.py&#34;, line 673, in run_until_complete
    self.run_forever()
  File &#34;/usr/lib/python3.12/asyncio/base_events.py&#34;, line 640, in run_forever
    self._run_once()
  File &#34;/usr/lib/python3.12/asyncio/base_events.py&#34;, line 1992, in _run_once
    handle._run()
  File &#34;/usr/lib/python3.12/asyncio/events.py&#34;, line 88, in _run
    self._context.run(self._callback, *self._args)
  File &#34;/home/work/work/infra/api/app/.venv/lib/python3.12/site-packages/anyio/from_thread.py&#34;, line 221, in _call_func
    retval = await retval_or_awaitable
  File &#34;/home/work/work/infra/api/app/.venv/lib/python3.12/site-packages/fastapi/applications.py&#34;, line 1054, in __call__
    await super().__call__(scope, receive, send)
  File &#34;/home/work/work/infra/api/app/.venv/lib/python3.12/site-packages/starlette/applications.py&#34;, line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File &#34;/home/work/work/infra/api/app/.venv/lib/python3.12/site-packages/starlette/middleware/errors.py&#34;, line 165, in __call__
    await self.app(scope, receive, _send)
  File &#34;/home/work/work/infra/api/app/middlewares/proxied_headers_middleware.py&#34;, line 34, in __call__
    await self.app(scope, receive, send)
  File &#34;/home/work/work/infra/api/app/.venv/lib/python3.12/site-packages/starlette/middleware/cors.py&#34;, line 85, in __call__
    await self.app(scope, receive, send)
  File &#34;/home/work/work/infra/api/app/.venv/lib/python3.12/site-packages/opentelemetry/instrumentation/asgi/__init__.py&#34;, line 735, in __call__
    await self.app(scope, otel_receive, otel_send)
  File &#34;/home/work/work/infra/api/app/.venv/lib/python3.12/site-packages/prometheus_fastapi_instrumentator/middleware.py&#34;, line 172, in __call__
    await self.app(scope, receive, send_wrapper)
  File &#34;/home/work/work/infra/api/app/.venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py&#34;, line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File &#34;/home/work/work/infra/api/app/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py&#34;, line 42, in wrapped_app
    await app(scope, receive, sender)
  File &#34;/home/work/work/infra/api/app/.venv/lib/python3.12/site-packages/starlette/routing.py&#34;, line 715, in __call__
    await self.middleware_stack(scope, receive, send)
  File &#34;/home/work/work/infra/api/app/.venv/lib/python3.12/site-packages/starlette/routing.py&#34;, line 735, in app
    await route.handle(scope, receive, send)
  File &#34;/home/work/work/infra/api/app/.venv/lib/python3.12/site-packages/starlette/routing.py&#34;, line 288, in handle
    await self.app(scope, receive, send)
  File &#34;/home/work/work/infra/api/app/.venv/lib/python3.12/site-packages/starlette/routing.py&#34;, line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File &#34;/home/work/work/infra/api/app/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py&#34;, line 42, in wrapped_app
    await app(scope, receive, sender)
  File &#34;/home/work/work/infra/api/app/.venv/lib/python3.12/site-packages/starlette/routing.py&#34;, line 73, in app
    response = await f(request)
  File &#34;/home/work/work/infra/api/app/.venv/lib/python3.12/site-packages/fastapi/routing.py&#34;, line 301, in app
    raw_response = await run_endpoint_function(
  File &#34;/home/work/work/infra/api/app/.venv/lib/python3.12/site-packages/fastapi/routing.py&#34;, line 212, in run_endpoint_function
    return await dependant.call(**values)
  File &#34;/home/work/work/infra/api/app/routes/assets/assets.py&#34;, line 42, in list_top
    return repo.top(session)
  File &#34;/home/work/work/infra/api/app/db/connection.py&#34;, line 96, in wrapper
    result = func(*args, **kwargs)
  File &#34;/home/work/work/infra/api/app/assets/repo.py&#34;, line 677, in top
    results = session.exec(top_published_assets_metadata_query).all()
  File &#34;/home/work/work/infra/api/app/.venv/lib/python3.12/site-packages/sqlmodel/orm/session.py&#34;, line 66, in exec
    results = super().execute(
  File &#34;/home/work/work/infra/api/app/.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py&#34;, line 2362, in execute
    return self._execute_internal(
  File &#34;/home/work/work/infra/api/app/.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py&#34;, line 2247, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File &#34;/home/work/work/infra/api/app/.venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py&#34;, line 305, in orm_execute_statement
    result = conn.execute(
  File &#34;/home/work/work/infra/api/app/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py&#34;, line 1418, in execute
    return meth(
  File &#34;/home/work/work/infra/api/app/.venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py&#34;, line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File &#34;/home/work/work/infra/api/app/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py&#34;, line 1653, in _execute_clauseelement
    self.dispatch.after_execute(
  File &#34;/home/work/work/infra/api/app/.venv/lib/python3.12/site-packages/sqlalchemy/event/attr.py&#34;, line 497, in __call__
    fn(*args, **kw)
  File &#34;/home/work/work/infra/api/app/.venv/lib/python3.12/site-packages/sqlalchemy/event/legacy.py&#34;, line 99, in wrap_leg
    return fn(*conv(*args))</code></pre>
                  </li>
              </ul>
            </div>

            <!-- ================================================== -->

          </div>
        </div>
    </div><!-- /.container -->


    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.8.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script type="text/javascript">
        jQuery(function($) {
            $(".toggle").click(function() {
                $(this).siblings(".trace").toggleClass("hidden");
            });
            $('#myTabs a').click(function (e) {
                $(this).tab('show');
                e.preventDefault();
            });
            $(".morequeries").click(function(e) {
                e.preventDefault();
                $(this).hide();
                $(this).prev("table").find("tr.hidden").removeClass("hidden");
            });
            $(".moreparams").click(function(e) {
                e.preventDefault();
                $(this).hide();
                $(this).prev("ul").find("li.hidden").removeClass("hidden");
            });
        });
    </script>
  </body>
</html>
