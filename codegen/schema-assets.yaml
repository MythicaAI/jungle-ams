# $schema: meta-schema.json
#
name: Asset Schema
description: Metadata to store relationships and descriptions of assets
tables:
  # The immutable asset reference, isomorphic with collections of assets
  # That is there is always a collection of 1 or N, other assets can be
  # added to an asset which is itself a collection. This relationship is not
  # intended to be recursive in order to simplify code that deals with collections.
  - name: Asset
    table_name: assets
    columns:
      - name: asset_seq
        type: BIGINT
        primary_key: true
      - name: created
        type: TIMESTAMP
        auto_create: true
      - name: updated
        type: TIMESTAMP
        auto_update: true
      - name: deleted
        type: TIMESTAMP
      - name: org_seq
        type: BIGINT
        relation: orgs.org_seq
      - name: owner_seq
        type: BIGINT
        foreign_key: profiles.profile_seq

  # Every time metadata of an asset changes it should generate a new revision
  # if the network or asset is incompatible with a previous version the minor
  # version should be bumped. Major versions should be bumped for large changes
  # that are intended to cause a migration or reflect a maturity level (0->1)
  - name: AssetVersion
    table_name: asset_versions
    columns:
      - name: asset_seq
        type: BIGINT
        primary_key: true
        foreign_key: assets.asset_seq
      - name: published
        type: BOOLEAN
      - name: major
        type: INTEGER
        primary_key: true
      - name: minor
        type: INTEGER
        primary_key: true
      - name: patch
        type: INTEGER
        primary_key: true
      - name: commit_ref
        type: TEXT
      - name: created
        type: TIMESTAMP
        auto_create: true
      - name: name
        type: TEXT
      - name: description
        type: TEXT
      - name: author_seq
        type: BIGINT
        nullable: false
        foreign_key: profiles.profile_seq
      - name: package_seq
        description: FileContent reference for the packaged version of this revision
        foreign_key: files.file_seq
        type: BIGINT
      - name: contents
        type: JSON
      - name: deleted
        type: TIMESTAMP

  # Cross table relation between asset and tags
  - name: AssetTag
    table_name: asset_tags
    columns:
      - name: type_seq
        type: BIGINT
        primary_key: true
        foreign_key: assets.asset_seq
      - name: tag_seq
        type: BIGINT
        primary_key: true
        foreign_key: tags.tag_seq