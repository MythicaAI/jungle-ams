# $schema: meta-schema.json
name: "Profile schema types"
description: "Types to represent profiles online"
tables:
  - name: Profile
    table_name: profiles
    columns:
      - name: profile_seq
        type: BIGINT
        primary_key: true
      - name: name
        type: TEXT
      - name: full_name
        type: TEXT
      - name: signature
        type: TEXT
      - name: created
        type: TIMESTAMP
        nullable: true
        auto_create: true
      - name: updated
        type: TIMESTAMP
        nullable: true
        auto_update: true
      - name: active
        type: BOOLEAN
      - name: profile_base_href
        type: TEXT
      - name: description
        type: TEXT
      - name: email
        type: TEXT
      - name: email_validate_state
        type: INTEGER
      - name: location
        type: TEXT
      - name: login_count
        type: INTEGER

  - name: OrgRef
    table_name: org_refs
    columns:
      - name: org_seq
        type: BIGINT
        foreign_key: orgs.org_seq
        primary_key: true
      - name: profile_seq
        type: UUID
        foreign_key: profiles.profile_seq
        primary_key: true
      - name: role
        type: TEXT
        primary_key: true
      - name: created
        type: TIMESTAMP
        auto_create: true
      - name: author_seq
        type: BIGINT
        foreign_key: profiles.profile_seq

  - name: Org
    table_name: orgs
    columns:
      - name: org_seq
        type: BIGINT
        primary_key: true
      - name: created
        type: TIMESTAMP
        auto_create: true
      - name: updated
        type: TIMESTAMP
        auto_update: true
      - name: name
        type: TEXT
      - name: description
        type: TEXT

  - name: ProfileSession
    table_name: profile_sessions
    columns:
      - name: profile_session_seq
        type: BIGINT
        primary_key: true
      - name: created
        description: Also the start time of the session
        type: TIMESTAMP
        auto_create: true
      - name: refreshed
        type: TIMESTAMP
      - name: profile_seq
        type: BIGINT
        foreign_key: profiles.profile_seq
        nullable: false
      - name: authenticated
        type: BOOLEAN
      - name: auth_token
        type: TEXT
      - name: refresh_token
        type: TEXT
      - name: location
        type: TEXT

  - name: ProfileFollower
    table_name: profile_followers
    columns:
      - name: profile_seq
        type: BIGINT
        primary_key: true
      - name: follower_seq
        type: BIGINT
        primary_key: true
      - name: created
        type: TIMESTAMP
        auto_create: true
      - name: deleted
        type: TIMESTAMP

  - name: ProfileKey
    table_name: profile_keys
    columns:
      - name: key
        type: TEXT
        primary_key: true
      - name: owner_seq
        type: BIGINT
        foreign_key: profiles.profile_seq
      - name: expires
        type: TIMESTAMP
      - name: payload
        type: JSON